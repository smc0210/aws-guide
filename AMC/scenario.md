# AWS 서버 이관 시나리오
### DB 백업 전
- parking
- cron정지
- db에 저장된 이미지 도메인 변경(에디터 contents)
- 임시 도메인(tourdanawa.com)으로 설정 된 부분 변경
- S3 Data 폴더 업로드 진행
- 도메인 설정
  - theminda.com name server 설정
  - aws 서브 도메인 설정
  - 기존 서버 virtual host 설정 -> parking 띄우고 롤백
  - ! 도메인 설정에서 예상대로 동작 안됨: 
  - ttl 시간 줄이는것을 요청 안함.
  - zns sub url 설정 정보 설정 -> 나중에야 받음...
  - 도메인 갱신이 생각보다 빨리 안됨...10시간 넘었는데 아직 실패가 자주뜨고 skt 폰은 접속도 안됨
- <위즈> aws n2 스키마 table 전체삭제
- <위즈> 스키마 덤프 import(source ${path})

### DB 이관
- <드라곤님>  온프레미스 서버에서 데이터 덤프 (1번항목 테이블 3개를 제외한 데이터 덤프)
- <위즈> s3로 덤프파일 업로드 - 30분 
- <위즈> 웹서버에서 덤프파일 다운로드 - 5분 이내
- <위즈> 덤프파일 압축해제 -20분
- <위즈> 데이터 import - 1시간
    
### DB 이관 후
- cron 가동

# 반영후 이슈
- 도메인이 안정적으로 잡히는데까지 예상보다 많은 시간이 필요(48시간이상 필요하다고 느껴짐)
  - sk 폰 데이터로는 파킹 화면조차 노출 안됨 -> 3일 후 정상화됨.(zns쪽에 네임서버를 4개다 등록 해야하는데 2개만 등록한 사항이 있었음)
- 동일 쿼리가 실운영 rds에서 실행이 느린 현상 발생 -> rds 스펙이 낮아 스펙업하여 해결
- 메일이 전송 안됨 
  - 특정 제한 이상 발송시 aws에서 25번 포트를 막는 정책이 있어 reverse ip를 등록하여 메일 발송되게 함(info.theminda.com a레코드 등록) 
      (https://aws.amazon.com/forms/ec2-email-limit-rdns-request)
  - naver gmail 이외 메일 전송이 안됨.
  - session 코드 사용 되는 부분이 있음.
